/**
 * BezierEasing - use bezier curve for transition easing function
 * by Gaëtan Renaudeau 2014 - 2015 – MIT License
 *
 * Credits: is based on Firefox's nsSMILKeySpline.cpp
 * Usage:
 * var spline = BezierEasing([ 0.25, 0.1, 0.25, 1.0 ])
 * spline.get(x) => returns the easing value | x must be in [0, 1] range
 *
 */
// These values are established by empiricism with tests (tradeoff: performance VS precision)
var NEWTON_ITERATIONS = 4;
var NEWTON_MIN_SLOPE = 0.001;
var SUBDIVISION_PRECISION = 0.0000001;
var SUBDIVISION_MAX_ITERATIONS = 10;
var kSplineTableSize = 11;
var kSampleStepSize = 1.0 / (kSplineTableSize - 1.0);
var float32ArraySupported = typeof Float32Array === 'function';
function A(aA1, aA2) {
    return 1.0 - 3.0 * aA2 + 3.0 * aA1;
}
function B(aA1, aA2) {
    return 3.0 * aA2 - 6.0 * aA1;
}
function C(aA1) {
    return 3.0 * aA1;
}
// Returns x(t) given t, x1, and x2, or y(t) given t, y1, and y2.
function calcBezier(aT, aA1, aA2) {
    return ((A(aA1, aA2) * aT + B(aA1, aA2)) * aT + C(aA1)) * aT;
}
// Returns dx/dt given t, x1, and x2, or dy/dt given t, y1, and y2.
function getSlope(aT, aA1, aA2) {
    return 3.0 * A(aA1, aA2) * aT * aT + 2.0 * B(aA1, aA2) * aT + C(aA1);
}
function binarySubdivide(aX, aA, aB, mX1, mX2) {
    var currentX, currentT, i = 0;
    do {
        currentT = aA + (aB - aA) / 2.0;
        currentX = calcBezier(currentT, mX1, mX2) - aX;
        if (currentX > 0.0) {
            aB = currentT;
        }
        else {
            aA = currentT;
        }
    } while (Math.abs(currentX) > SUBDIVISION_PRECISION && ++i < SUBDIVISION_MAX_ITERATIONS);
    return currentT;
}
function newtonRaphsonIterate(aX, aGuessT, mX1, mX2) {
    for (var i = 0; i < NEWTON_ITERATIONS; ++i) {
        var currentSlope = getSlope(aGuessT, mX1, mX2);
        if (currentSlope === 0.0)
            return aGuessT;
        var currentX = calcBezier(aGuessT, mX1, mX2) - aX;
        aGuessT -= currentX / currentSlope;
    }
    return aGuessT;
}
/**
 * points is an array of [ mX1, mY1, mX2, mY2 ]
 */
export function BezierEasing(points, b, c, d) {
    if (arguments.length === 4) {
        // @ts-ignore
        return new BezierEasing([points, b, c, d]);
    }
    if (!(this instanceof BezierEasing)) { // @ts-ignore
        // @ts-ignore
        return new BezierEasing(points);
    }
    if (!points || points.length !== 4) {
        throw new Error('BezierEasing: points must contains 4 values');
    }
    for (var i = 0; i < 4; ++i) {
        if (typeof points[i] !== 'number' || isNaN(points[i]) || !isFinite(points[i])) {
            throw new Error('BezierEasing: points should be integers.');
        }
    }
    if (points[0] < 0 || points[0] > 1 || points[2] < 0 || points[2] > 1) {
        throw new Error('BezierEasing x values must be in [0, 1] range.');
    }
    this._str = 'BezierEasing(' + points + ')';
    this._css = 'cubic-bezier(' + points + ')';
    this._p = points;
    this._mSampleValues = float32ArraySupported ? new Float32Array(kSplineTableSize) : new Array(kSplineTableSize);
    this._precomputed = false;
    this.get = this.get.bind(this);
}
BezierEasing.prototype = {
    get: function (x) {
        var mX1 = this._p[0], mY1 = this._p[1], mX2 = this._p[2], mY2 = this._p[3];
        if (!this._precomputed)
            this._precompute();
        if (mX1 === mY1 && mX2 === mY2)
            return x; // linear
        // Because JavaScript number are imprecise, we should guarantee the extremes are right.
        if (x === 0)
            return 0;
        if (x === 1)
            return 1;
        return calcBezier(this._getTForX(x), mY1, mY2);
    },
    getPoints: function () {
        return this._p;
    },
    toString: function () {
        return this._str;
    },
    toCSS: function () {
        return this._css;
    },
    // Private part
    _precompute: function () {
        var mX1 = this._p[0], mY1 = this._p[1], mX2 = this._p[2], mY2 = this._p[3];
        this._precomputed = true;
        if (mX1 !== mY1 || mX2 !== mY2)
            this._calcSampleValues();
    },
    _calcSampleValues: function () {
        var mX1 = this._p[0], mX2 = this._p[2];
        for (var i = 0; i < kSplineTableSize; ++i) {
            this._mSampleValues[i] = calcBezier(i * kSampleStepSize, mX1, mX2);
        }
    },
    /**
     * getTForX chose the fastest heuristic to determine the percentage value precisely from a given X projection.
     */
    _getTForX: function (aX) {
        var mX1 = this._p[0], mX2 = this._p[2], mSampleValues = this._mSampleValues;
        var intervalStart = 0.0;
        var currentSample = 1;
        var lastSample = kSplineTableSize - 1;
        for (; currentSample !== lastSample && mSampleValues[currentSample] <= aX; ++currentSample) {
            intervalStart += kSampleStepSize;
        }
        --currentSample;
        // Interpolate to provide an initial guess for t
        var dist = (aX - mSampleValues[currentSample]) / (mSampleValues[currentSample + 1] - mSampleValues[currentSample]);
        var guessForT = intervalStart + dist * kSampleStepSize;
        var initialSlope = getSlope(guessForT, mX1, mX2);
        if (initialSlope >= NEWTON_MIN_SLOPE) {
            return newtonRaphsonIterate(aX, guessForT, mX1, mX2);
        }
        else if (initialSlope === 0.0) {
            return guessForT;
        }
        else {
            return binarySubdivide(aX, intervalStart, intervalStart + kSampleStepSize, mX1, mX2);
        }
    }
};
// CSS mapping
// @ts-ignore
BezierEasing.css = {
    // @ts-ignore
    ease: BezierEasing.ease = BezierEasing(0.25, 0.1, 0.25, 1.0),
    // @ts-ignore
    linear: BezierEasing.linear = BezierEasing(0.00, 0.0, 1.00, 1.0),
    // @ts-ignore
    'ease-in': BezierEasing.easeIn = BezierEasing(0.42, 0.0, 1.00, 1.0),
    // @ts-ignore
    'ease-out': BezierEasing.easeOut = BezierEasing(0.00, 0.0, 0.58, 1.0),
    // @ts-ignore
    'ease-in-out': BezierEasing.easeInOut = BezierEasing(0.42, 0.0, 0.58, 1.0)
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmV6aWVyRWFzaW5nLmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmd4LWRlc2t0b3AvIiwic291cmNlcyI6WyJsaWIvY29tcG9uZW50cy9wcm9ncmVzcy1jaXJjbGUvYmV6aWVyRWFzaW5nLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7R0FTRztBQUVILDZGQUE2RjtBQUM3RixJQUFJLGlCQUFpQixHQUFHLENBQUMsQ0FBQztBQUMxQixJQUFJLGdCQUFnQixHQUFHLEtBQUssQ0FBQztBQUM3QixJQUFJLHFCQUFxQixHQUFHLFNBQVMsQ0FBQztBQUN0QyxJQUFJLDBCQUEwQixHQUFHLEVBQUUsQ0FBQztBQUVwQyxJQUFJLGdCQUFnQixHQUFHLEVBQUUsQ0FBQztBQUMxQixJQUFJLGVBQWUsR0FBRyxHQUFHLEdBQUcsQ0FBQyxnQkFBZ0IsR0FBRyxHQUFHLENBQUMsQ0FBQztBQUVyRCxJQUFJLHFCQUFxQixHQUFHLE9BQU8sWUFBWSxLQUFLLFVBQVUsQ0FBQztBQUUvRCxTQUFTLENBQUMsQ0FBQyxHQUFHLEVBQUUsR0FBRztJQUNqQixPQUFPLEdBQUcsR0FBRyxHQUFHLEdBQUcsR0FBRyxHQUFHLEdBQUcsR0FBRyxHQUFHLENBQUM7QUFDckMsQ0FBQztBQUVELFNBQVMsQ0FBQyxDQUFDLEdBQUcsRUFBRSxHQUFHO0lBQ2pCLE9BQU8sR0FBRyxHQUFHLEdBQUcsR0FBRyxHQUFHLEdBQUcsR0FBRyxDQUFDO0FBQy9CLENBQUM7QUFFRCxTQUFTLENBQUMsQ0FBQyxHQUFHO0lBQ1osT0FBTyxHQUFHLEdBQUcsR0FBRyxDQUFDO0FBQ25CLENBQUM7QUFFRCxpRUFBaUU7QUFDakUsU0FBUyxVQUFVLENBQUMsRUFBRSxFQUFFLEdBQUcsRUFBRSxHQUFHO0lBQzlCLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUMsR0FBRyxFQUFF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QVksSUFBSSxnQkFBZ0IsRUFBRTtZQUNwQyxPQUFPLG9CQUFvQixDQUFDLEVBQUUsRUFBRSxTQUFTLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1NBQ3REO2FBQU0sSUFBSSxZQUFZLEtBQUssR0FBRyxFQUFFO1lBQy9CLE9BQU8sU0FBUyxDQUFDO1NBQ2xCO2FBQU07WUFDTCxPQUFPLGVBQWUsQ0FBQyxFQUFFLEVBQUUsYUFBYSxFQUFFLGFBQWEsR0FBRyxlQUFlLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1NBQ3RGO0lBQ0gsQ0FBQztDQUNGLENBQUM7QUFFRixjQUFjO0FBQ2QsYUFBYTtBQUNiLFlBQVksQ0FBQyxHQUFHLEdBQUc7SUFDbkIsYUFBYTtJQUNYLElBQUksRUFBRSxZQUFZLENBQUMsSUFBSSxHQUFHLFlBQVksQ0FBQyxJQUFJLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxHQUFHLENBQUM7SUFDOUQsYUFBYTtJQUNYLE1BQU0sRUFBRSxZQUFZLENBQUMsTUFBTSxHQUFHLFlBQVksQ0FBQyxJQUFJLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxHQUFHLENBQUM7SUFDbEUsYUFBYTtJQUNYLFNBQVMsRUFBRSxZQUFZLENBQUMsTUFBTSxHQUFHLFlBQVksQ0FBQyxJQUFJLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxHQUFHLENBQUM7SUFDckUsYUFBYTtJQUNYLFVBQVUsRUFBRSxZQUFZLENBQUMsT0FBTyxHQUFHLFlBQVksQ0FBQyxJQUFJLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxHQUFHLENBQUM7SUFDdkUsYUFBYTtJQUNYLGFBQWEsRUFBRSxZQUFZLENBQUMsU0FBUyxHQUFHLFlBQVksQ0FBQyxJQUFJLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxHQUFHLENBQUM7Q0FDM0UsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBCZXppZXJFYXNpbmcgLSB1c2UgYmV6aWVyIGN1cnZlIGZvciB0cmFuc2l0aW9uIGVhc2luZyBmdW5jdGlvblxyXG4gKiBieSBHYcOrdGFuIFJlbmF1ZGVhdSAyMDE0IC0gMjAxNSDigJMgTUlUIExpY2Vuc2VcclxuICpcclxuICogQ3JlZGl0czogaXMgYmFzZWQgb24gRmlyZWZveCdzIG5zU01JTEtleVNwbGluZS5jcHBcclxuICogVXNhZ2U6XHJcbiAqIHZhciBzcGxpbmUgPSBCZXppZXJFYXNpbmcoWyAwLjI1LCAwLjEsIDAuMjUsIDEuMCBdKVxyXG4gKiBzcGxpbmUuZ2V0KHgpID0+IHJldHVybnMgdGhlIGVhc2luZyB2YWx1ZSB8IHggbXVzdCBiZSBpbiBbMCwgMV0gcmFuZ2VcclxuICpcclxuICovXHJcblxyXG4vLyBUaGVzZSB2YWx1ZXMgYXJlIGVzdGFibGlzaGVkIGJ5IGVtcGlyaWNpc20gd2l0aCB0ZXN0cyAodHJhZGVvZmY6IHBlcmZvcm1hbmNlIFZTIHByZWNpc2lvbilcclxudmFyIE5FV1RPTl9JVEVSQVRJT05TID0gNDtcclxudmFyIE5FV1RPTl9NSU5fU0xPUEUgPSAwLjAwMTtcclxudmFyIFNVQkRJVklTSU9OX1BSRUNJU0lPTiA9IDAuMDAwMDAwMTtcclxudmFyIFNVQkRJVklTSU9OX01BWF9JVEVSQVRJT05TID0gMTA7XHJcblxyXG52YXIga1NwbGluZVRhYmxlU2l6ZSA9IDExO1xyXG52YXIga1NhbXBsZVN0ZXBTaXplID0gMS4wIC8gKGtTcGxpbmVUYWJsZVNpemUgLSAxLjApO1xyXG5cclxudmFyIGZsb2F0MzJBcnJheVN1cHBvcnRlZCA9IHR5cGVvZiBGbG9hdDMyQXJyYXkgPT09ICdmdW5jdGlvbic7XHJcblxyXG5mdW5jdGlvbiBBKGFBMSwgYUEyKSB7XHJcbiAgcmV0dXJuIDEuMCAtIDMuMCAqIGFBMiArIDMuMCAqIGFBMTtcclxufVxyXG5cclxuZnVuY3Rpb24gQihhQTEsIGFBMikge1xyXG4gIHJldHVybiAzLjAgKiBhQTIgLSA2LjAgKiBhQTE7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIEMoYUExKSB7XHJcbiAgcmV0dXJuIDMuMCAqIGFBMTtcclxufVxyXG5cclxuLy8gUmV0dXJucyB4KHQpIGdpdmVuIHQsIHgxLCBhbmQgeDIsIG9yIHkodCkgZ2l2ZW4gdCwgeTEsIGFuZCB5Mi5cclxuZnVuY3Rpb24gY2FsY0JlemllcihhVCwgYUExLCBhQTIpIHtcclxuICByZXR1cm4gKChBKGFBMSwgYUEyKSAqIGFUICsgQihhQTEsIGFBMikpICogYVQgKyBDKGFBMSkpICogYVQ7XHJcbn1cclxuXHJcbi8vIFJldHVybnMgZHgvZHQgZ2l2ZW4gdCwgeDEsIGFuZCB4Miwgb3IgZHkvZHQgZ2l2ZW4gdCwgeTEsIGFuZCB5Mi5cclxuZnVuY3Rpb24gZ2V0U2xvcGUoYVQsIGFBMSwgYUEyKSB7XHJcbiAgcmV0dXJuIDMuMCAqIEEoYUExLCBhQTIpICogYVQgKiBhVCArIDIuMCAqIEIoYUExLCBhQTIpICogYVQgKyBDKGFBMSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGJpbmFyeVN1YmRpdmlkZShhWCwgYUEsIGFCLCBtWDEsIG1YMikge1xyXG4gIHZhciBjdXJyZW50WCwgY3VycmVudFQsIGkgPSAwO1xyXG4gIGRvIHtcclxuICAgIGN1cnJlbnRUID0gYUEgKyAoYUIgLSBhQSkgLyAyLjA7XHJcbiAgICBjdXJyZW50WCA9IGNhbGNCZXppZXIoY3VycmVudFQsIG1YMSwgbVgyKSAtIGFYO1xyXG4gICAgaWYgKGN1cnJlbnRYID4gMC4wKSB7XHJcbiAgICAgIGFCID0gY3VycmVudFQ7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBhQSA9IGN1cnJlbnRUO1xyXG4gICAgfVxyXG4gIH0gd2hpbGUgKE1hdGguYWJzKGN1cnJlbnRYKSA+IFNVQkRJVklTSU9OX1BSRUNJU0lPTiAmJiArK2kgPCBTVUJESVZJU0lPTl9NQVhfSVRFUkFUSU9OUyk7XHJcbiAgcmV0dXJuIGN1cnJlbnRUO1xyXG59XHJcblxyXG5mdW5jdGlvbiBuZXd0b25SYXBoc29uSXRlcmF0ZShhWCwgYUd1ZXNzVCwgbVgxLCBtWDIpIHtcclxuICBmb3IgKHZhciBpID0gMDsgaSA8IE5FV1RPTl9JVEVSQVRJT05TOyArK2kpIHtcclxuICAgIHZhciBjdXJyZW50U2xvcGUgPSBnZXRTbG9wZShhR3Vlc3NULCBtWDEsIG1YMik7XHJcbiAgICBpZiAoY3VycmVudFNsb3BlID09PSAwLjApIHJldHVybiBhR3Vlc3NUO1xyXG4gICAgdmFyIGN1cnJlbnRYID0gY2FsY0JlemllcihhR3Vlc3NULCBtWDEsIG1YMikgLSBhWDtcclxuICAgIGFHdWVzc1QgLT0gY3VycmVudFggLyBjdXJyZW50U2xvcGU7XHJcbiAgfVxyXG4gIHJldHVybiBhR3Vlc3NUO1xyXG59XHJcblxyXG4vKipcclxuICogcG9pbnRzIGlzIGFuIGFycmF5IG9mIFsgbVgxLCBtWTEsIG1YMiwgbVkyIF1cclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBCZXppZXJFYXNpbmcocG9pbnRzLCBiPywgYz8sIGQ/KSB7XHJcbiAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDQpIHtcclxuICAgIC8vIEB0cy1pZ25vcmVcclxuICAgIHJldHVybiBuZXcgQmV6aWVyRWFzaW5nKFtwb2ludHMsIGIsIGMsIGRdKTtcclxuICB9XHJcbiAgaWYgKCEodGhpcyBpbnN0YW5jZW9mIEJlemllckVhc2luZykpIHsgLy8gQHRzLWlnbm9yZVxyXG4gICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgcmV0dXJuIG5ldyBCZXppZXJFYXNpbmcocG9pbnRzKTtcclxuICB9XHJcblxyXG4gIGlmICghcG9pbnRzIHx8IHBvaW50cy5sZW5ndGggIT09IDQpIHtcclxuICAgIHRocm93IG5ldyBFcnJvcignQmV6aWVyRWFzaW5nOiBwb2ludHMgbXVzdCBjb250YWlucyA0IHZhbHVlcycpO1xyXG4gIH1cclxuICBmb3IgKGxldCBpID0gMDsgaSA8IDQ7ICsraSkge1xyXG4gICAgaWYgKHR5cGVvZiBwb2ludHNbaV0gIT09ICdudW1iZXInIHx8IGlzTmFOKHBvaW50c1tpXSkgfHwgIWlzRmluaXRlKHBvaW50c1tpXSkpIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdCZXppZXJFYXNpbmc6IHBvaW50cyBzaG91bGQgYmUgaW50ZWdlcnMuJyk7XHJcbiAgICB9XHJcbiAgfVxyXG4gIGlmIChwb2ludHNbMF0gPCAwIHx8IHBvaW50c1swXSA+IDEgfHwgcG9pbnRzWzJdIDwgMCB8fCBwb2ludHNbMl0gPiAxKSB7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0JlemllckVhc2luZyB4IHZhbHVlcyBtdXN0IGJlIGluIFswLCAxXSByYW5nZS4nKTtcclxuICB9XHJcblxyXG4gIHRoaXMuX3N0ciA9ICdCZXppZXJFYXNpbmcoJyArIHBvaW50cyArICcpJztcclxuICB0aGlzLl9jc3MgPSAnY3ViaWMtYmV6aWVyKCcgKyBwb2ludHMgKyAnKSc7XHJcbiAgdGhpcy5fcCA9IHBvaW50cztcclxuICB0aGlzLl9tU2FtcGxlVmFsdWVzID0gZmxvYXQzMkFycmF5U3VwcG9ydGVkID8gbmV3IEZsb2F0MzJBcnJheShrU3BsaW5lVGFibGVTaXplKSA6IG5ldyBBcnJheShrU3BsaW5lVGFibGVTaXplKTtcclxuICB0aGlzLl9wcmVjb21wdXRlZCA9IGZhbHNlO1xyXG5cclxuICB0aGlzLmdldCA9IHRoaXMuZ2V0LmJpbmQodGhpcyk7XHJcbn1cclxuXHJcbkJlemllckVhc2luZy5wcm90b3R5cGUgPSB7XHJcblxyXG4gIGdldDogZnVuY3Rpb24oeCkge1xyXG4gICAgbGV0IG1YMSA9IHRoaXMuX3BbMF0sXHJcbiAgICAgIG1ZMSA9IHRoaXMuX3BbMV0sXHJcbiAgICAgIG1YMiA9IHRoaXMuX3BbMl0sXHJcbiAgICAgIG1ZMiA9IHRoaXMuX3BbM107XHJcbiAgICBpZiAoIXRoaXMuX3ByZWNvbXB1dGVkKSB0aGlzLl9wcmVjb21wdXRlKCk7XHJcbiAgICBpZiAobVgxID09PSBtWTEgJiYgbVgyID09PSBtWTIpIHJldHVybiB4OyAvLyBsaW5lYXJcclxuICAgIC8vIEJlY2F1c2UgSmF2YVNjcmlwdCBudW1iZXIgYXJlIGltcHJlY2lzZSwgd2Ugc2hvdWxkIGd1YXJhbnRlZSB0aGUgZXh0cmVtZXMgYXJlIHJpZ2h0LlxyXG4gICAgaWYgKHggPT09IDApIHJldHVybiAwO1xyXG4gICAgaWYgKHggPT09IDEpIHJldHVybiAxO1xyXG4gICAgcmV0dXJuIGNhbGNCZXppZXIodGhpcy5fZ2V0VEZvclgoeCksIG1ZMSwgbVkyKTtcclxuICB9LFxyXG5cclxuICBnZXRQb2ludHM6IGZ1bmN0aW9uICgpIHtcclxuICAgIHJldHVybiB0aGlzLl9wO1xyXG4gIH0sXHJcblxyXG4gIHRvU3RyaW5nOiBmdW5jdGlvbiAoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fc3RyO1xyXG4gIH0sXHJcblxyXG4gIHRvQ1NTOiBmdW5jdGlvbiAoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fY3NzO1xyXG4gIH0sXHJcblxyXG4gIC8vIFByaXZhdGUgcGFydFxyXG5cclxuICBfcHJlY29tcHV0ZTogZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIG1YMSA9IHRoaXMuX3BbMF0sXHJcbiAgICAgIG1ZMSA9IHRoaXMuX3BbMV0sXHJcbiAgICAgIG1YMiA9IHRoaXMuX3BbMl0sXHJcbiAgICAgIG1ZMiA9IHRoaXMuX3BbM107XHJcbiAgICB0aGlzLl9wcmVjb21wdXRlZCA9IHRydWU7XHJcbiAgICBpZiAobVgxICE9PSBtWTEgfHwgbVgyICE9PSBtWTIpXHJcbiAgICAgIHRoaXMuX2NhbGNTYW1wbGVWYWx1ZXMoKTtcclxuICB9LFxyXG5cclxuICBfY2FsY1NhbXBsZVZhbHVlczogZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIG1YMSA9IHRoaXMuX3BbMF0sXHJcbiAgICAgIG1YMiA9IHRoaXMuX3BbMl07XHJcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGtTcGxpbmVUYWJsZVNpemU7ICsraSkge1xyXG4gICAgICB0aGlzLl9tU2FtcGxlVmFsdWVzW2ldID0gY2FsY0JlemllcihpICoga1NhbXBsZVN0ZXBTaXplLCBtWDEsIG1YMik7XHJcbiAgICB9XHJcbiAgfSxcclxuXHJcbiAgLyoqXHJcbiAgICogZ2V0VEZvclggY2hvc2UgdGhlIGZhc3Rlc3QgaGV1cmlzdGljIHRvIGRldGVybWluZSB0aGUgcGVyY2VudGFnZSB2YWx1ZSBwcmVjaXNlbHkgZnJvbSBhIGdpdmVuIFggcHJvamVjdGlvbi5cclxuICAgKi9cclxuICBfZ2V0VEZvclg6IGZ1bmN0aW9uIChhWCkge1xyXG4gICAgdmFyIG1YMSA9IHRoaXMuX3BbMF0sXHJcbiAgICAgIG1YMiA9IHRoaXMuX3BbMl0sXHJcbiAgICAgIG1TYW1wbGVWYWx1ZXMgPSB0aGlzLl9tU2FtcGxlVmFsdWVzO1xyXG5cclxuICAgIGxldCBpbnRlcnZhbFN0YXJ0ID0gMC4wO1xyXG4gICAgbGV0IGN1cnJlbnRTYW1wbGUgPSAxO1xyXG4gICAgY29uc3QgbGFzdFNhbXBsZSA9IGtTcGxpbmVUYWJsZVNpemUgLSAxO1xyXG5cclxuICAgIGZvciAoOyBjdXJyZW50U2FtcGxlICE9PSBsYXN0U2FtcGxlICYmIG1TYW1wbGVWYWx1ZXNbY3VycmVudFNhbXBsZV0gPD0gYVg7ICsrY3VycmVudFNhbXBsZSkge1xyXG4gICAgICBpbnRlcnZhbFN0YXJ0ICs9IGtTYW1wbGVTdGVwU2l6ZTtcclxuICAgIH1cclxuICAgIC0tY3VycmVudFNhbXBsZTtcclxuXHJcbiAgICAvLyBJbnRlcnBvbGF0ZSB0byBwcm92aWRlIGFuIGluaXRpYWwgZ3Vlc3MgZm9yIHRcclxuICAgIGNvbnN0IGRpc3QgPSAoYVggLSBtU2FtcGxlVmFsdWVzW2N1cnJlbnRTYW1wbGVdKSAvIChtU2FtcGxlVmFsdWVzW2N1cnJlbnRTYW1wbGUgKyAxXSAtIG1TYW1wbGVWYWx1ZXNbY3VycmVudFNhbXBsZV0pO1xyXG4gICAgY29uc3QgZ3Vlc3NGb3JUID0gaW50ZXJ2YWxTdGFydCArIGRpc3QgKiBrU2FtcGxlU3RlcFNpemU7XHJcblxyXG4gICAgY29uc3QgaW5pdGlhbFNsb3BlID0gZ2V0U2xvcGUoZ3Vlc3NGb3JULCBtWDEsIG1YMik7XHJcbiAgICBpZiAoaW5pdGlhbFNsb3BlID49IE5FV1RPTl9NSU5fU0xPUEUpIHtcclxuICAgICAgcmV0dXJuIG5ld3RvblJhcGhzb25JdGVyYXRlKGFYLCBndWVzc0ZvclQsIG1YMSwgbVgyKTtcclxuICAgIH0gZWxzZSBpZiAoaW5pdGlhbFNsb3BlID09PSAwLjApIHtcclxuICAgICAgcmV0dXJuIGd1ZXNzRm9yVDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiBiaW5hcnlTdWJkaXZpZGUoYVgsIGludGVydmFsU3RhcnQsIGludGVydmFsU3RhcnQgKyBrU2FtcGxlU3RlcFNpemUsIG1YMSwgbVgyKTtcclxuICAgIH1cclxuICB9XHJcbn07XHJcblxyXG4vLyBDU1MgbWFwcGluZ1xyXG4vLyBAdHMtaWdub3JlXHJcbkJlemllckVhc2luZy5jc3MgPSB7XHJcbi8vIEB0cy1pZ25vcmVcclxuICBlYXNlOiBCZXppZXJFYXNpbmcuZWFzZSA9IEJlemllckVhc2luZygwLjI1LCAwLjEsIDAuMjUsIDEuMCksXHJcbi8vIEB0cy1pZ25vcmVcclxuICBsaW5lYXI6IEJlemllckVhc2luZy5saW5lYXIgPSBCZXppZXJFYXNpbmcoMC4wMCwgMC4wLCAxLjAwLCAxLjApLFxyXG4vLyBAdHMtaWdub3JlXHJcbiAgJ2Vhc2UtaW4nOiBCZXppZXJFYXNpbmcuZWFzZUluID0gQmV6aWVyRWFzaW5nKDAuNDIsIDAuMCwgMS4wMCwgMS4wKSxcclxuLy8gQHRzLWlnbm9yZVxyXG4gICdlYXNlLW91dCc6IEJlemllckVhc2luZy5lYXNlT3V0ID0gQmV6aWVyRWFzaW5nKDAuMDAsIDAuMCwgMC41OCwgMS4wKSxcclxuLy8gQHRzLWlnbm9yZVxyXG4gICdlYXNlLWluLW91dCc6IEJlemllckVhc2luZy5lYXNlSW5PdXQgPSBCZXppZXJFYXNpbmcoMC40MiwgMC4wLCAwLjU4LCAxLjApXHJcbn07XHJcblxyXG4iXX0=